(function(e,t){"use strict";var n,r,i,s,o={},u={},a=[],f={},l={poll:25,html5:false,force:false};u.setup=function(t){var n=l.html5&&"pushState"in e.history?"popstate":"hashchange";if(l.force)u.force();if("on"+n in e){u.listen(e,n,t)}else{var r=e.location.href;setInterval(function(){var n=e.location.href;if(r!==n){r=n;t.call(e)}},l.poll)}};u.force=function(){var e=t.getElementsByTagName("a");var n=function(){var e=this.getAttribute("href");var t=u.sanitize(e.substr(e.indexOf("#")+1));if(t===s){u.change()}};for(var r=0;r<e.length;r++){var i=e[r];if(i.hasAttribute("href")&&i.getAttribute("href").indexOf("#")!==-1){u.listen(i,"click",n)}}};u.promise=function(){var e=this;e.stack=[];e.then=function(t){e.stack.push(t)};e.resolve=function(){while(e.stack.length){return e.stack.shift().call(n)}}};u.route=function(e,t){var n=[];e="^"+e;e=e.replace(/(\?)?\{([^}]+)\}/g,function(e,t,r){n.push({name:r,optional:typeof t!=="undefined"?true:false});return"([\\w-.]+)?"}).replace(/\//g,"\\/?");e+="\\/?$";a.push({regex:new RegExp(e),params:n,directions:t})};u.change=function(){s=u.state();var t=u.match(s);if(t){var a=o;o=t.params;var f=u.dispatch("change",o,a);if(l.html5&&"pushState"in e.history){e.history.replaceState(u.extend(o,{hash:s}),"{Satnav}","/"+s)}var c=function(){t.directions.call(n,o)};if(f instanceof u.promise){i.then(c)}else{c()}}else{e.location.hash=r||""}};u.sanitize=function(e){return e.replace(/^\//g,"")};u.match=function(e){for(var t in a){var n=a[t];var r=e.match(n.regex);if(r){var i={};for(var s=1,o=r.length;s<o;s++){if(typeof r[s]==="undefined"&&!n.params[s-1].optional){throw new Error("[Satnav] A required route parameter was not defined")}else if(typeof r[s]!=="undefined"){i[n.params[s-1].name]=r[s]}}return{directions:n.directions,params:i}}}return undefined};u.dispatch=function(e){var t=Array.prototype.slice.call(arguments,1);return e in f&&f[e].apply(n,t)};u.state=function(){return e.history.state&&e.history.state.hash?e.history.state.hash:u.sanitize(e.location.hash.substr(1))};u.extend=function(e,t){for(var n in t){e[n]=e.hasOwnProperty(n)?e[n]:t[n]}return e};u.listen=function(){if(e.addEventListener){return function(e,t,n){e.addEventListener(t,n,false)}}else if(e.attachEvent){return function(e,t,n){e.attachEvent("on"+t,function(){n.call(e)},false)}}}();n=function(e){l=u.extend(e,l);return n};n.defer=function(){i=new u.promise;return i}();n.resolve=function(){setTimeout(i.resolve,1)};n.navigate=function(e){if("path"in e){if(a.length===0){u.setup(u.change)}u.route(u.sanitize(e.path),"directions"in e?e.directions:function(){})}else{throw new Error("[Satnav] A required argument was not defined")}return n};n.otherwise=function(e){r=typeof e==="string"?u.sanitize(e):"path"in e?u.sanitize(e.path):"";return n};n.change=function(e){f.change=e;return n};n.go=function(){u.change();return n};if(typeof e.define==="function"&&e.define.amd){e.define("Satnav",[],function(){return n})}else if(typeof e.module!=="undefined"&&e.module.exports){e.module.exports=n}else{e.sN=e.Satnav=n}})(window,document)
